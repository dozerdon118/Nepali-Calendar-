<!DOCTYPE html>
<html lang="ne">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>नेपाली पात्रो 2082</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body {
      font-family: 'Mukta', sans-serif;
      background: url('https://upload.wikimedia.org/wikipedia/commons/thumb/8/86/Flag_of_Nepal.svg/1920px-Flag_of_Nepal.svg.png') no-repeat center center fixed;
      background-size: cover;
      backdrop-filter: blur(4px);
      color: #1a202c;
    }
    header {
      background: linear-gradient(to right, #ff6b6b, #f06595);
      color: white;
      border-radius: 8px;
    }
    table th, table td {
      vertical-align: middle;
      height: 80px;
    }
    .today {
      background-color: #ffe066 !important;
      font-weight: bold;
      border-radius: 6px;
    }
    #eventContent {
      min-height: 80px;
    }
    .calendar-day {
      position: relative;
    }
    .event-dot {
      position: absolute;
      bottom: 6px;
      right: 6px;
      width: 8px;
      height: 8px;
      background-color: #f03e3e;
      border-radius: 50%;
    }
    thead th {
      background-color: #ffc9c9;
      font-weight: bold;
    }
    .btn-reminder {
      background-color: #fff3cd;
      font-weight: bold;
    }
    @media (max-width: 768px) {
      header h1 {
        font-size: 24px;
      }
      table th, table td {
        height: 60px;
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
  <div class="container-fluid py-3">
    <header class="text-center p-3 mb-3 shadow">
      <h1 class="fw-bold">नेपाली पात्रो २०८२</h1>
      <p id="calendarTitle" class="fs-5">आजको मिति: </p>
    </header>
    <div class="row">
      <aside class="col-md-3 mb-3">
        <h5>आजको मिति</h5>
        <div id="liveDate" class="alert alert-primary fw-semibold"></div>
        <div class="mt-4">
          <h6>कार्यक्रम</h6>
          <div id="eventContent" class="alert alert-warning">कुनै कार्यक्रम छैन</div>
        </div>
        <div class="mt-4">
          <h6>Reminder</h6>
          <input id="reminderInput" type="text" placeholder="नयाँ Reminder लेख्नुहोस" class="form-control mb-2">
          <button class="btn btn-sm btn-outline-primary w-100 btn-reminder" onclick="addReminder()">सेभ गर्नुहोस</button>
          <ul id="reminderList" class="list-group mt-2"></ul>
        </div>
      </aside>
      <main class="col-md-9">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <button class="btn btn-outline-danger" id="prevMonthBtn">← अघिल्लो महिना</button>
          <div id="currentMonth" class="fw-bold fs-4"></div>
          <button class="btn btn-outline-success" id="nextMonthBtn">अर्को महिना →</button>
        </div>
        <table class="table table-bordered text-center shadow-sm">
          <thead class="table-secondary">
            <tr>
              <th>आइत</th>
              <th>सोम</th>
              <th>मंगल</th>
              <th>बुध</th>
              <th>बिही</th>
              <th>शुक्र</th>
              <th>शनि</th>
            </tr>
          </thead>
          <tbody id="calendarBody"></tbody>
        </table>
      </main>
    </div>
  </div>

  <script>
    const events2082 = {};
    const nepaliMonths = ["बैशाख", "जेठ", "आषाढ", "श्रावण", "भदौ", "आश्विन", "कार्तिक", "मंसिर", "पौष", "माघ", "फाल्गुण", "चैत्र"];
    const daysInMonths = [31, 32, 31, 32, 31, 30, 30, 29, 29, 30, 29, 30];
    let currentMonth = 0;
    let currentYear = 2082;
    let todayBsDate = "";
    let monthStartDay = 1;

    function renderCalendar() {
      const calendarBody = document.getElementById("calendarBody");
      const eventContent = document.getElementById("eventContent");
      const currentMonthTitle = document.getElementById("currentMonth");
      const calendarTitle = document.getElementById("calendarTitle");
      const today = new Date();
      const adDate = `${today.getDate()}-${today.getMonth() + 1}-${today.getFullYear()}`;
      calendarTitle.textContent = `आजको मिति: ${todayBsDate} (BS) / ${adDate} (AD)`;
      currentMonthTitle.textContent = `${nepaliMonths[currentMonth]} ${currentYear}`;
      calendarBody.innerHTML = "";
      let date = 1;
      const days = daysInMonths[currentMonth];
      for (let i = 0; i < 6; i++) {
        const row = document.createElement("tr");
        for (let j = 0; j < 7; j++) {
          const cell = document.createElement("td");
          if (i === 0 && j < monthStartDay) {
            cell.textContent = "";
          } else if (date > days) {
            cell.textContent = "";
          } else {
            const fullDate = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(date).padStart(2, '0')}`;
            cell.textContent = date;
            cell.classList.add("calendar-day");
            if (fullDate === todayBsDate) {
              cell.classList.add("today");
              eventContent.textContent = events2082[fullDate]?.join(" / ") || "कुनै कार्यक्रम छैन";
            }
            if (events2082[fullDate]) {
              const dot = document.createElement("div");
              dot.classList.add("event-dot");
              cell.appendChild(dot);
            }
            date++;
          }
          row.appendChild(cell);
        }
        calendarBody.appendChild(row);
        if (date > days) break;
      }
    }

    function updateLiveDate() {
      const liveDate = document.getElementById("liveDate");
      const today = new Date();
      const days = ["आइतबार", "सोमबार", "मंगलबार", "बुधबार", "बिहीबार", "शुक्रबार", "शनिबार"];
      liveDate.textContent = `${days[today.getDay()]}, ${today.getDate()}-${today.getMonth() + 1}-${today.getFullYear()} (AD)`;
    }

    async function fetchTodayBsDate() {
      try {
        const today = new Date();
        const y = today.getFullYear();
        const m = today.getMonth() + 1;
        const d = today.getDate();
        const res = await fetch(`https://nepali-date-api.vercel.app/api/date/ad/${y}-${m}-${d}`);
        const data = await res.json();
        todayBsDate = data.bs;
        renderCalendar();
      } catch (e) {
        todayBsDate = "2082-02-16";
        renderCalendar();
      }
    }

    function scheduleDailyUpdate() {
      setInterval(() => {
        const now = new Date();
        if (now.getHours() === 2 && now.getMinutes() === 0) {
          fetchTodayBsDate();
        }
      }, 60000);
    }

    function addReminder() {
      const input = document.getElementById("reminderInput");
      const list = document.getElementById("reminderList");
      if (input.value.trim()) {
        const item = document.createElement("li");
        item.textContent = input.value;
        item.className = "list-group-item";
        list.appendChild(item);
        input.value = "";
        fetch('https://your-backend-api.com/saveReminder', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ reminder: item.textContent })
        });
      }
    }

    document.getElementById("prevMonthBtn").addEventListener("click", () => {
      monthStartDay = (monthStartDay - (daysInMonths[(currentMonth + 11) % 12] % 7) + 7) % 7;
      currentMonth = (currentMonth - 1 + 12) % 12;
      renderCalendar();
    });

    document.getElementById("nextMonthBtn").addEventListener("click", () => {
      monthStartDay = (monthStartDay + (daysInMonths[currentMonth] % 7)) % 7;
      currentMonth = (currentMonth + 1) % 12;
      renderCalendar();
    });

    updateLiveDate();
    fetchTodayBsDate();
    scheduleDailyUpdate();
  </script>
</body>
</html>
